// Truststay Database Schema - Prisma
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// ENUMS
// ========================================

enum Gender {
  male
  female
  other
}

enum PropertyType {
  room
  apartment
  house
  dormitory
}

enum BookingStatus {
  pending
  approved
  rejected
  cancelled
}

enum RentalStatus {
  active
  terminated
  expired
  pending_renewal
}

enum PaymentType {
  rent
  deposit
  utility
  fee
  refund
}

enum PaymentMethod {
  bank_transfer
  cash
  e_wallet
  card
}

enum PaymentStatus {
  pending
  completed
  failed
  refunded
}

enum CalculationMethod {
  fixed
  per_unit
  per_person
  per_vehicle
}

enum BillingCycle {
  monthly
  quarterly
  usage_based
}

enum CostPaymentStatus {
  pending
  paid
  overdue
  waived
}

enum ReviewerType {
  tenant
  owner
}

enum TicketType {
  technical
  payment
  property
  user_report
  other
}

enum TicketPriority {
  low
  medium
  high
  urgent
}

enum TicketStatus {
  open
  in_progress
  resolved
  closed
}

enum ReportType {
  inappropriate_behavior
  fraud
  property_misrepresentation
  other
}

enum ReportStatus {
  pending
  under_review
  resolved
  dismissed
}

enum AmenityCategory {
  basic
  kitchen
  bathroom
  entertainment
  safety
  connectivity
  building
}

enum CostCategory {
  utility
  service
  parking
  maintenance
}

enum Visibility {
  anyoneCanFind
  anyoneWithLink
  domainCanFind
  domainWithLink
  limited
}

// ========================================
// USER MANAGEMENT
// ========================================

model User {
  id               String    @id @default(uuid())
  email            String    @unique
  phone            String?   @unique
  passwordHash     String    @map("password_hash")
  firstName        String    @map("first_name")
  lastName         String    @map("last_name")
  avatarUrl        String?   @map("avatar_url")
  dateOfBirth      DateTime? @map("date_of_birth") @db.Date
  gender           Gender?
  isVerified       Boolean   @default(false) @map("is_verified")
  isActive         Boolean   @default(true) @map("is_active")
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")

  // Relations
  profile                    UserProfile?
  addresses                  UserAddress[]
  ownedProperties            Property[]                   @relation("PropertyOwner")
  bookingRequests            BookingRequest[]
  rentalsAsTenant            Rental[]                     @relation("RentalTenant")
  rentalsAsOwner             Rental[]                     @relation("RentalOwner")
  payments                   Payment[]
  sentMessages               Message[]
  conversations              Conversation[]               @relation("ConversationParticipants")
  reviewsGiven               Review[]                     @relation("ReviewGiver")
  reviewsReceived            Review[]                     @relation("ReviewReceiver")
  supportTickets             SupportTicket[]
  reportsSubmitted           UserReport[]                 @relation("ReportSubmitter")
  reportsReceived            UserReport[]                 @relation("ReportReceived")
  notifications              Notification[]
  activityLogs               ActivityLog[]
  customAmenities            UserCustomAmenity[]
  customCostTypes            UserCustomCostType[]
  amenityAdoptions           UserAmenityAdoption[]
  costAdoptions              UserCostAdoption[]
  utilityReadingsRecorded    UtilityReading[]             @relation("ReadingRecorder")
  utilityReadingsVerified    UtilityReading[]             @relation("ReadingVerifier")

  @@map("users")
}

model UserProfile {
  id                      String    @id @default(uuid())
  userId                  String    @unique @map("user_id")
  bio                     String?
  occupation              String?
  languages               String[]
  emergencyContactName    String?   @map("emergency_contact_name")
  emergencyContactPhone   String?   @map("emergency_contact_phone")
  verificationDocuments   Json?     @map("verification_documents")
  createdAt               DateTime  @default(now()) @map("created_at")
  updatedAt               DateTime  @updatedAt @map("updated_at")

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

model UserAddress {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  addressLine1 String   @map("address_line_1")
  addressLine2 String?  @map("address_line_2")
  ward         String?
  district     String
  city         String
  country      String   @default("Vietnam")
  postalCode   String?  @map("postal_code")
  isPrimary    Boolean  @default(false) @map("is_primary")
  createdAt    DateTime @default(now()) @map("created_at")

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_addresses")
}

// ========================================
// PROPERTY MANAGEMENT
// ========================================

model Property {
  id           String       @id @default(uuid())
  ownerId      String       @map("owner_id")
  title        String
  description  String?
  propertyType PropertyType @map("property_type")
  addressLine1 String       @map("address_line_1")
  addressLine2 String?      @map("address_line_2")
  ward         String?
  district     String
  city         String
  country      String       @default("Vietnam")
  latitude     Decimal?     @db.Decimal(10, 8)
  longitude    Decimal?     @db.Decimal(11, 8)
  areaSqm      Decimal?     @map("area_sqm") @db.Decimal(8, 2)
  maxOccupancy Int          @default(1) @map("max_occupancy")
  isActive     Boolean      @default(true) @map("is_active")
  isVerified   Boolean      @default(false) @map("is_verified")
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")

  // Relations
  owner              User                  @relation("PropertyOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  amenities          PropertyAmenity[]
  costs              PropertyCost[]
  images             PropertyImage[]
  rules              PropertyRule[]
  pricing            PropertyPricing?
  availability       PropertyAvailability[]
  bookingRequests    BookingRequest[]
  rentals            Rental[]
  conversations      Conversation[]
  supportTickets     SupportTicket[]

  @@index([ownerId])
  @@index([district, city])
  @@index([propertyType])
  @@index([isActive])
  @@index([latitude, longitude])
  @@map("properties")
}

model PropertyImage {
  id         String   @id @default(uuid())
  propertyId String   @map("property_id")
  imageUrl   String   @map("image_url")
  altText    String?  @map("alt_text")
  sortOrder  Int      @default(0) @map("sort_order")
  isPrimary  Boolean  @default(false) @map("is_primary")
  createdAt  DateTime @default(now()) @map("created_at")

  // Relations
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("property_images")
}

model PropertyRule {
  id          String   @id @default(uuid())
  propertyId  String   @map("property_id")
  ruleType    String   @map("rule_type") // smoking, pets, visitors, noise, other
  ruleText    String   @map("rule_text")
  isMandatory Boolean  @default(true) @map("is_mandatory")
  createdAt   DateTime @default(now()) @map("created_at")

  // Relations
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("property_rules")
}

// ========================================
// FLEXIBLE AMENITIES SYSTEM
// ========================================

model SystemAmenity {
  id          String            @id @default(uuid())
  name        String
  nameEn      String            @unique @map("name_en")
  category    AmenityCategory
  iconUrl     String?           @map("icon_url")
  description String?
  isActive    Boolean           @default(true) @map("is_active")
  sortOrder   Int               @default(0) @map("sort_order")
  createdAt   DateTime          @default(now()) @map("created_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")

  // Relations
  propertyAmenities PropertyAmenity[]

  @@index([category])
  @@index([isActive])
  @@map("system_amenities")
}

model UserCustomAmenity {
  id          String            @id @default(uuid())
  creatorId   String            @map("creator_id")
  name        String
  category    String?
  iconUrl     String?           @map("icon_url")
  description String?
  isPublic    Boolean           @default(false) @map("is_public")
  usageCount  Int               @default(0) @map("usage_count")
  createdAt   DateTime          @default(now()) @map("created_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")

  // Relations
  creator           User                    @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  propertyAmenities PropertyAmenity[]
  adoptions         UserAmenityAdoption[]

  @@unique([creatorId, name, category])
  @@index([creatorId])
  @@index([isPublic])
  @@index([category])
  @@map("user_custom_amenities")
}

model PropertyAmenity {
  id                    String             @id @default(uuid())
  propertyId            String             @map("property_id")
  systemAmenityId       String?            @map("system_amenity_id")
  userCustomAmenityId   String?            @map("user_custom_amenity_id")
  customValue           String?            @map("custom_value")
  notes                 String?
  createdAt             DateTime           @default(now()) @map("created_at")

  // Relations
  property          Property           @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  systemAmenity     SystemAmenity?     @relation(fields: [systemAmenityId], references: [id], onDelete: Cascade)
  userCustomAmenity UserCustomAmenity? @relation(fields: [userCustomAmenityId], references: [id], onDelete: Cascade)

  @@unique([propertyId, systemAmenityId])
  @@unique([propertyId, userCustomAmenityId])
  @@index([propertyId])
  @@index([systemAmenityId])
  @@index([userCustomAmenityId])
  @@map("property_amenities")
}

model UserAmenityAdoption {
  id                String            @id @default(uuid())
  userId            String            @map("user_id")
  customAmenityId   String            @map("custom_amenity_id")
  adoptedAt         DateTime          @default(now()) @map("adopted_at")

  // Relations
  user          User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  customAmenity UserCustomAmenity @relation(fields: [customAmenityId], references: [id], onDelete: Cascade)

  @@unique([userId, customAmenityId])
  @@map("user_amenity_adoptions")
}

// ========================================
// FLEXIBLE COST TYPES SYSTEM
// ========================================

model SystemCostType {
  id                String            @id @default(uuid())
  name              String
  nameEn            String            @unique @map("name_en")
  category          CostCategory
  calculationMethod CalculationMethod @map("calculation_method")
  defaultUnit       String?           @map("default_unit")
  iconUrl           String?           @map("icon_url")
  description       String?
  isActive          Boolean           @default(true) @map("is_active")
  sortOrder         Int               @default(0) @map("sort_order")
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")

  // Relations
  propertyCosts PropertyCost[]

  @@index([category])
  @@index([isActive])
  @@map("system_cost_types")
}

model UserCustomCostType {
  id                String            @id @default(uuid())
  creatorId         String            @map("creator_id")
  name              String
  category          String?
  calculationMethod CalculationMethod @map("calculation_method")
  unit              String?
  description       String?
  isPublic          Boolean           @default(false) @map("is_public")
  usageCount        Int               @default(0) @map("usage_count")
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")

  // Relations
  creator       User               @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  propertyCosts PropertyCost[]
  adoptions     UserCostAdoption[]

  @@unique([creatorId, name, category])
  @@index([creatorId])
  @@index([isPublic])
  @@map("user_custom_cost_types")
}

model PropertyCost {
  id                   String              @id @default(uuid())
  propertyId           String              @map("property_id")
  systemCostTypeId     String?             @map("system_cost_type_id")
  userCustomCostTypeId String?             @map("user_custom_cost_type_id")
  baseRate             Decimal             @map("base_rate") @db.Decimal(15, 2)
  currency             String              @default("VND")
  pricingTiers         Json?               @map("pricing_tiers")
  includedAmount       Decimal             @default(0) @map("included_amount") @db.Decimal(10, 2)
  minimumCharge        Decimal?            @map("minimum_charge") @db.Decimal(15, 2)
  maximumCharge        Decimal?            @map("maximum_charge") @db.Decimal(15, 2)
  billingCycle         BillingCycle        @default(monthly) @map("billing_cycle")
  paymentDeadlineDays  Int                 @default(5) @map("payment_deadline_days")
  lateFeeRate          Decimal?            @map("late_fee_rate") @db.Decimal(5, 2)
  notes                String?
  isActive             Boolean             @default(true) @map("is_active")
  createdAt            DateTime            @default(now()) @map("created_at")
  updatedAt            DateTime            @updatedAt @map("updated_at")

  // Relations
  property            Property             @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  systemCostType      SystemCostType?      @relation(fields: [systemCostTypeId], references: [id], onDelete: Cascade)
  userCustomCostType  UserCustomCostType?  @relation(fields: [userCustomCostTypeId], references: [id], onDelete: Cascade)
  utilityReadings     UtilityReading[]
  costCalculations    CostCalculation[]

  @@unique([propertyId, systemCostTypeId])
  @@unique([propertyId, userCustomCostTypeId])
  @@index([propertyId])
  @@index([isActive])
  @@map("property_costs")
}

model UtilityReading {
  id              String   @id @default(uuid())
  rentalId        String   @map("rental_id")
  propertyCostId  String   @map("property_cost_id")
  readingDate     DateTime @map("reading_date") @db.Date
  previousReading Decimal? @map("previous_reading") @db.Decimal(10, 2)
  currentReading  Decimal? @map("current_reading") @db.Decimal(10, 2)
  consumption     Decimal? @db.Decimal(10, 2)
  meterPhotos     String[] @map("meter_photos")
  notes           String?
  recordedById    String?  @map("recorded_by")
  verifiedById    String?  @map("verified_by")
  verificationDate DateTime? @map("verification_date")
  createdAt       DateTime @default(now()) @map("created_at")

  // Relations
  rental           Rental            @relation(fields: [rentalId], references: [id], onDelete: Cascade)
  propertyCost     PropertyCost      @relation(fields: [propertyCostId], references: [id], onDelete: Cascade)
  recordedBy       User?             @relation("ReadingRecorder", fields: [recordedById], references: [id])
  verifiedBy       User?             @relation("ReadingVerifier", fields: [verifiedById], references: [id])
  costCalculations CostCalculation[]

  @@index([rentalId])
  @@index([readingDate])
  @@map("utility_readings")
}

model CostCalculation {
  id                  String            @id @default(uuid())
  rentalId            String            @map("rental_id")
  propertyCostId      String            @map("property_cost_id")
  utilityReadingId    String?           @map("utility_reading_id")
  billingPeriodStart  DateTime          @map("billing_period_start") @db.Date
  billingPeriodEnd    DateTime          @map("billing_period_end") @db.Date
  baseAmount          Decimal?          @map("base_amount") @db.Decimal(10, 2)
  billableAmount      Decimal?          @map("billable_amount") @db.Decimal(10, 2)
  tierCalculations    Json?             @map("tier_calculations")
  subtotal            Decimal           @db.Decimal(15, 2)
  discountAmount      Decimal           @default(0) @map("discount_amount") @db.Decimal(15, 2)
  totalAmount         Decimal           @map("total_amount") @db.Decimal(15, 2)
  paymentStatus       CostPaymentStatus @default(pending) @map("payment_status")
  dueDate             DateTime          @map("due_date") @db.Date
  paidAmount          Decimal           @default(0) @map("paid_amount") @db.Decimal(15, 2)
  paymentDate         DateTime?         @map("payment_date")
  lateFeeApplied      Decimal           @default(0) @map("late_fee_applied") @db.Decimal(15, 2)
  notes               String?
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")

  // Relations
  rental         Rental          @relation(fields: [rentalId], references: [id], onDelete: Cascade)
  propertyCost   PropertyCost    @relation(fields: [propertyCostId], references: [id], onDelete: Cascade)
  utilityReading UtilityReading? @relation(fields: [utilityReadingId], references: [id], onDelete: SetNull)

  @@index([rentalId])
  @@index([paymentStatus])
  @@index([dueDate])
  @@map("cost_calculations")
}

model UserCostAdoption {
  id               String             @id @default(uuid())
  userId           String             @map("user_id")
  customCostTypeId String             @map("custom_cost_type_id")
  adoptedAt        DateTime           @default(now()) @map("adopted_at")

  // Relations
  user           User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  customCostType UserCustomCostType @relation(fields: [customCostTypeId], references: [id], onDelete: Cascade)

  @@unique([userId, customCostTypeId])
  @@map("user_cost_adoptions")
}

// ========================================
// PRICING & AVAILABILITY
// ========================================

model PropertyPricing {
  id                    String   @id @default(uuid())
  propertyId            String   @unique @map("property_id")
  basePriceMonthly      Decimal  @map("base_price_monthly") @db.Decimal(15, 2)
  currency              String   @default("VND")
  depositAmount         Decimal  @map("deposit_amount") @db.Decimal(15, 2)
  depositMonths         Int      @default(1) @map("deposit_months")
  utilityIncluded       Boolean  @default(false) @map("utility_included")
  utilityCostMonthly    Decimal? @map("utility_cost_monthly") @db.Decimal(15, 2)
  cleaningFee           Decimal? @map("cleaning_fee") @db.Decimal(15, 2)
  serviceFeePercentage  Decimal? @map("service_fee_percentage") @db.Decimal(5, 2)
  minimumStayMonths     Int      @default(1) @map("minimum_stay_months")
  maximumStayMonths     Int?     @map("maximum_stay_months")
  priceNegotiable       Boolean  @default(false) @map("price_negotiable")
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  // Relations
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("property_pricing")
}

model PropertyAvailability {
  id            String   @id @default(uuid())
  propertyId    String   @map("property_id")
  availableFrom DateTime @map("available_from") @db.Date
  availableTo   DateTime? @map("available_to") @db.Date
  isAvailable   Boolean  @default(true) @map("is_available")
  notes         String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  // Relations
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("property_availability")
}

// ========================================
// BOOKING & RENTAL MANAGEMENT
// ========================================

model BookingRequest {
  id            String        @id @default(uuid())
  propertyId    String        @map("property_id")
  tenantId      String        @map("tenant_id")
  moveInDate    DateTime      @map("move_in_date") @db.Date
  moveOutDate   DateTime?     @map("move_out_date") @db.Date
  rentalMonths  Int?          @map("rental_months")
  monthlyRent   Decimal       @map("monthly_rent") @db.Decimal(15, 2)
  depositAmount Decimal       @map("deposit_amount") @db.Decimal(15, 2)
  totalAmount   Decimal       @map("total_amount") @db.Decimal(15, 2)
  status        BookingStatus @default(pending)
  messageToOwner String?      @map("message_to_owner")
  ownerNotes    String?       @map("owner_notes")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  // Relations
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  tenant   User     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  rental   Rental?

  @@index([propertyId])
  @@index([tenantId])
  @@index([status])
  @@map("booking_requests")
}

model Rental {
  id                    String       @id @default(uuid())
  bookingRequestId      String?      @unique @map("booking_request_id")
  propertyId            String       @map("property_id")
  tenantId              String       @map("tenant_id")
  ownerId               String       @map("owner_id")
  contractStartDate     DateTime     @map("contract_start_date") @db.Date
  contractEndDate       DateTime?    @map("contract_end_date") @db.Date
  monthlyRent           Decimal      @map("monthly_rent") @db.Decimal(15, 2)
  depositPaid           Decimal      @map("deposit_paid") @db.Decimal(15, 2)
  status                RentalStatus @default(active)
  contractDocumentUrl   String?      @map("contract_document_url")
  terminationNoticeDate DateTime?    @map("termination_notice_date") @db.Date
  terminationReason     String?      @map("termination_reason")
  createdAt             DateTime     @default(now()) @map("created_at")
  updatedAt             DateTime     @updatedAt @map("updated_at")

  // Relations
  bookingRequest   BookingRequest?   @relation(fields: [bookingRequestId], references: [id])
  property         Property          @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  tenant           User              @relation("RentalTenant", fields: [tenantId], references: [id], onDelete: Cascade)
  owner            User              @relation("RentalOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  payments         Payment[]
  utilityReadings  UtilityReading[]
  costCalculations CostCalculation[]
  reviews          Review[]

  @@index([propertyId])
  @@index([tenantId])
  @@index([status])
  @@map("rentals")
}

model Payment {
  id                   String        @id @default(uuid())
  rentalId             String        @map("rental_id")
  payerId              String        @map("payer_id")
  paymentType          PaymentType   @map("payment_type")
  amount               Decimal       @db.Decimal(15, 2)
  currency             String        @default("VND")
  paymentMethod        PaymentMethod? @map("payment_method")
  paymentStatus        PaymentStatus @default(pending) @map("payment_status")
  paymentDate          DateTime?     @map("payment_date")
  dueDate              DateTime?     @map("due_date") @db.Date
  description          String?
  transactionReference String?       @map("transaction_reference")
  createdAt            DateTime      @default(now()) @map("created_at")
  updatedAt            DateTime      @updatedAt @map("updated_at")

  // Relations
  rental Rental @relation(fields: [rentalId], references: [id], onDelete: Cascade)
  payer  User   @relation(fields: [payerId], references: [id], onDelete: Cascade)

  @@index([rentalId])
  @@index([payerId])
  @@index([paymentStatus])
  @@index([paymentDate])
  @@map("payments")
}

// ========================================
// COMMUNICATION & REVIEWS
// ========================================

model Conversation {
  id              String   @id @default(uuid())
  propertyId      String?  @map("property_id")
  participants    String[] // Array of user IDs
  subject         String?
  lastMessageAt   DateTime @default(now()) @map("last_message_at")
  createdAt       DateTime @default(now()) @map("created_at")

  // Relations
  property Property? @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  messages Message[]
  users    User[]    @relation("ConversationParticipants")

  @@index([propertyId])
  @@map("conversations")
}

model Message {
  id             String   @id @default(uuid())
  conversationId String   @map("conversation_id")
  senderId       String   @map("sender_id")
  messageText    String   @map("message_text")
  attachmentUrls String[] @map("attachment_urls")
  isRead         Boolean  @default(false) @map("is_read")
  readAt         DateTime? @map("read_at")
  createdAt      DateTime @default(now()) @map("created_at")

  // Relations
  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender       User         @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([senderId])
  @@map("messages")
}

model Review {
  id                  String       @id @default(uuid())
  rentalId            String       @map("rental_id")
  reviewerId          String       @map("reviewer_id")
  revieweeId          String       @map("reviewee_id")
  reviewerType        ReviewerType @map("reviewer_type")
  propertyRating      Int?         @map("property_rating")
  communicationRating Int?         @map("communication_rating")
  cleanlinessRating   Int?         @map("cleanliness_rating")
  overallRating       Int?         @map("overall_rating")
  reviewText          String?      @map("review_text")
  isPublic            Boolean      @default(true) @map("is_public")
  responseText        String?      @map("response_text")
  responseDate        DateTime?    @map("response_date")
  createdAt           DateTime     @default(now()) @map("created_at")

  // Relations
  rental   Rental @relation(fields: [rentalId], references: [id], onDelete: Cascade)
  reviewer User   @relation("ReviewGiver", fields: [reviewerId], references: [id], onDelete: Cascade)
  reviewee User   @relation("ReviewReceiver", fields: [revieweeId], references: [id], onDelete: Cascade)

  @@index([rentalId])
  @@index([revieweeId])
  @@map("reviews")
}

// ========================================
// SUPPORT & REPORTING
// ========================================

model SupportTicket {
  id              String         @id @default(uuid())
  userId          String         @map("user_id")
  propertyId      String?        @map("property_id")
  rentalId        String?        @map("rental_id")
  ticketType      TicketType     @map("ticket_type")
  priority        TicketPriority @default(medium)
  status          TicketStatus   @default(open)
  subject         String
  description     String
  attachments     String[]
  assignedTo      String?        @map("assigned_to")
  resolutionNotes String?        @map("resolution_notes")
  resolvedAt      DateTime?      @map("resolved_at")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  // Relations
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  property Property? @relation(fields: [propertyId], references: [id], onDelete: SetNull)

  @@map("support_tickets")
}

model UserReport {
  id               String       @id @default(uuid())
  reporterId       String       @map("reporter_id")
  reportedUserId   String       @map("reported_user_id")
  propertyId       String?      @map("property_id")
  reportType       ReportType   @map("report_type")
  description      String
  evidenceUrls     String[]     @map("evidence_urls")
  status           ReportStatus @default(pending)
  adminNotes       String?      @map("admin_notes")
  actionTaken      String?      @map("action_taken")
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")

  // Relations
  reporter     User @relation("ReportSubmitter", fields: [reporterId], references: [id], onDelete: Cascade)
  reportedUser User @relation("ReportReceived", fields: [reportedUserId], references: [id], onDelete: Cascade)

  @@map("user_reports")
}

// ========================================
// SYSTEM TABLES
// ========================================

model Notification {
  id               String    @id @default(uuid())
  userId           String    @map("user_id")
  notificationType String    @map("notification_type")
  title            String
  message          String
  data             Json?
  isRead           Boolean   @default(false) @map("is_read")
  readAt           DateTime? @map("read_at")
  expiresAt        DateTime? @map("expires_at")
  createdAt        DateTime  @default(now()) @map("created_at")

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model ActivityLog {
  id           String   @id @default(uuid())
  userId       String?  @map("user_id")
  activityType String   @map("activity_type")
  description  String
  entityType   String?  @map("entity_type")
  entityId     String?  @map("entity_id")
  metadata     Json?
  ipAddress    String?  @map("ip_address")
  userAgent    String?  @map("user_agent")
  createdAt    DateTime @default(now()) @map("created_at")

  // Relations
  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("activity_logs")
}