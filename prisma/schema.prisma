// Truststay Database Schema - Prisma
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// ENUMS
// ========================================

enum Gender {
  male
  female
  other
}

enum UserRole {
  tenant
  landlord
}

enum RoomType {
  boarding_house // Nhà trọ
  dormitory // Ký túc xá
  sleepbox // Sleepbox
  apartment // Chung cư
  whole_house // Nhà nguyên căn
}

enum RequestStatus {
  pending
  accepted
  rejected
  expired
  cancelled
  awaiting_confirmation // Chờ xác nhận
}

enum RentalStatus {
  active
  terminated
  expired
  pending_renewal
}

// InvitationStatus removed - using RequestStatus instead

enum BillStatus {
  draft
  pending
  paid
  overdue
  cancelled
}

enum PaymentType {
  rent
  deposit
  utility
  fee
  refund
}

enum PaymentMethod {
  bank_transfer
  cash
  e_wallet
  card
}

enum PaymentStatus {
  pending
  completed
  failed
  refunded
}


enum RatingTargetType {
  tenant
  landlord
  room
}

enum AmenityCategory {
  basic
  kitchen
  bathroom
  entertainment
  safety
  connectivity
  building
}

enum CostCategory {
  utility
  service
  parking
  maintenance
}

enum RuleCategory {
  smoking // Hút thuốc
  pets // Thú cưng
  visitors // Khách thăm
  noise // Tiếng ồn
  cleanliness // Vệ sinh
  security // An ninh
  usage // Sử dụng
  other // Khác
}

enum RuleType {
  allowed // Được phép
  forbidden // Cấm
  required // Bắt buộc
  conditional // Có điều kiện
}

enum CostType {
  fixed // Giá cố định hàng tháng
  per_unit // Theo đơn vị (kWh, m³)
  metered // Theo đồng hồ
  percentage // Theo phần trăm
  tiered // Bậc thang (khác nhau theo mức sử dụng)
}

enum BillingCycle {
  daily
  weekly
  monthly
  quarterly
  yearly
  per_use
}

enum Visibility {
  anyoneCanFind
  anyoneWithLink
  domainCanFind
  domainWithLink
  limited
}

enum SearchPostStatus {
  active
  paused
  closed
  expired
}

enum VerificationType {
  email
  phone
  password_reset
}

enum VerificationStatus {
  pending
  verified
  expired
  failed
}

// Chat message types
enum ChatMessageType {
  text
  invitation
  request
}

enum RoommatePostStatus {
  draft
  pending_approval // Chờ landlord duyệt
  active
  paused
  closed
  expired
}

// RoommateApplicationStatus removed - using RequestStatus instead

enum RoomStatus {
  available // Phòng trống, sẵn sàng cho thuê
  occupied // Phòng đã có người ở
  maintenance // Phòng đang sửa chữa/bảo trì
  reserved // Phòng đã được đặt cọc nhưng chưa vào ở
  unavailable // Phòng tạm thời không cho thuê
}

enum ContractType {
  monthly_rental // Thuê theo tháng
  yearly_rental // Thuê theo năm  
  daily_rental // Thuê theo ngày
}

enum ContractStatus {
  draft // Nháp
  pending_signature // Chờ ký
  partially_signed // Đã ký 1 phần
  fully_signed // Đã ký đầy đủ
  active // Đang hiệu lực
  expired // Hết hạn
  terminated // Chấm dứt
}

enum SignerRole {
  landlord // Bên A - Cho thuê
  tenant // Bên B - Thuê
  witness // Người làm chứng
}

// ========================================
// USER MANAGEMENT
// ========================================

model User {
  id                 String    @id @default(uuid())
  email              String    @unique
  phone              String?   @unique
  passwordHash       String    @map("password_hash")
  firstName          String    @map("first_name")
  lastName           String    @map("last_name")
  avatarUrl          String?   @map("avatar_url")
  dateOfBirth        DateTime? @map("date_of_birth") @db.Date
  gender             Gender?
  role               UserRole  @default(tenant)
  bio                String?
  idCardNumber       String?   @map("id_card_number")
  idCardImages       String[]  @map("id_card_images")
  bankAccount        String?   @map("bank_account")
  bankName           String?   @map("bank_name")
  isVerifiedPhone    Boolean   @default(false) @map("is_verified_phone")
  isVerifiedEmail    Boolean   @default(false) @map("is_verified_email")
  isVerifiedIdentity Boolean   @default(false) @map("is_verified_identity")
  isVerifiedBank     Boolean   @default(false) @map("is_verified_bank")
  isOnline           Boolean   @default(false) @map("is_online")
  lastActiveAt       DateTime? @map("last_active_at") @db.Timestamp

  // Overall Rating fields
  overallRating Decimal? @default(0) @map("overall_rating") @db.Decimal(3, 2)
  totalRatings  Int      @default(0) @map("total_ratings")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  addresses            UserAddress[]
  ownedBuildings       Building[]                 @relation("BuildingOwner")
  roomBookings         RoomBooking[]
  rentalsAsTenant      Rental[]                   @relation("RentalTenant")
  rentalsAsOwner       Rental[]                   @relation("RentalOwner")
  payments             Payment[]
  sentInvitations      RoomInvitation[]           @relation("InvitationSender")
  receivedInvitations  RoomInvitation[]           @relation("InvitationReceiver")
  ratingsGiven         Rating[]                   @relation("RatingGiver")
  notifications        Notification[]
  verificationCodes    VerificationCode[]
  refreshTokens        RefreshToken[]
  roomRequests         RoomSeekingPost[]
  roommateSeekingPosts RoommateSeekingPost[]
  roommateApplications RoommateApplication[]
  roomPreferences      TenantRoomPreferences?
  roommatePreferences  TenantRoommatePreferences?
  conversationsAsUserA Conversation[]             @relation("ConversationUserA")
  conversationsAsUserB Conversation[]             @relation("ConversationUserB")
  messagesSent         Message[]
  contractsAsLandlord  Contract[]                 @relation("LandlordContracts")
  contractsAsTenant    Contract[]                 @relation("TenantContracts")
  contractSignatures   ContractSignature[]
  contractAuditLogs    ContractAuditLog[]

  @@map("users")
}

model VerificationCode {
  id          String             @id @default(uuid())
  userId      String?            @map("user_id") // Optional vì có thể verify trước khi tạo user
  email       String? // Email hoặc phone được verify
  phone       String?
  type        VerificationType
  code        String // 6-digit verification code
  status      VerificationStatus @default(pending)
  attempts    Int                @default(0) // Số lần thử verify
  maxAttempts Int                @default(5) // Tối đa 5 lần thử
  expiresAt   DateTime           @map("expires_at")
  verifiedAt  DateTime?          @map("verified_at")
  createdAt   DateTime           @default(now()) @map("created_at")
  updatedAt   DateTime           @updatedAt @map("updated_at")

  // Relations
  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([phone])
  @@index([code])
  @@index([type])
  @@index([status])
  @@index([expiresAt])
  @@map("verification_codes")
}

model RefreshToken {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@map("refresh_tokens")
}

model UserAddress {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  addressLine1 String   @map("address_line_1")
  addressLine2 String?  @map("address_line_2")
  wardId       Int?     @map("ward_id")
  districtId   Int      @map("district_id")
  provinceId   Int      @map("province_id")
  country      String   @default("Vietnam")
  postalCode   String?  @map("postal_code")
  isPrimary    Boolean  @default(false) @map("is_primary")
  createdAt    DateTime @default(now()) @map("created_at")

  // Relations
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  ward     Ward?    @relation(fields: [wardId], references: [id], onDelete: SetNull)
  district District @relation(fields: [districtId], references: [id], onDelete: Cascade)
  province Province @relation(fields: [provinceId], references: [id], onDelete: Cascade)

  @@index([districtId])
  @@index([provinceId])
  @@index([wardId])
  @@map("user_addresses")
}

// ========================================
// BUILDING & ROOM MANAGEMENT
// ========================================

model Building {
  id           String   @id // slug format: "nha-tro-minh-phat-quan-9"
  slug         String   @unique // auto-generated from name + district
  ownerId      String   @map("owner_id")
  name         String
  description  String?
  addressLine1 String   @map("address_line_1")
  addressLine2 String?  @map("address_line_2")
  wardId       Int?     @map("ward_id")
  districtId   Int      @map("district_id")
  provinceId   Int      @map("province_id")
  country      String   @default("Vietnam")
  latitude     Decimal? @db.Decimal(10, 7)
  longitude    Decimal? @db.Decimal(10, 7)
  isActive     Boolean  @default(true) @map("is_active")
  isVerified   Boolean  @default(false) @map("is_verified")

  // Overall Rating fields  
  overallRating Decimal? @default(0) @map("overall_rating") @db.Decimal(3, 2)
  totalRatings  Int      @default(0) @map("total_ratings")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  owner    User     @relation("BuildingOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  ward     Ward?    @relation(fields: [wardId], references: [id], onDelete: SetNull)
  district District @relation(fields: [districtId], references: [id], onDelete: Cascade)
  province Province @relation(fields: [provinceId], references: [id], onDelete: Cascade)
  rooms    Room[]

  @@index([ownerId])
  @@index([districtId, provinceId])
  @@index([isActive])
  @@index([slug])
  @@index([latitude, longitude])
  @@index([districtId])
  @@index([provinceId])
  @@index([wardId])
  @@map("buildings")
}

model Room {
  id           String   @id @default(uuid())
  slug         String   @unique // auto-generated from building + room type
  buildingId   String   @map("building_id")
  floorNumber  Int?     @map("floor_number")
  name         String // Tên loại phòng: "Phòng VIP", "Phòng thường"
  description  String?
  roomType     RoomType @map("room_type")
  areaSqm      Decimal? @map("area_sqm") @db.Decimal(8, 2)
  maxOccupancy Int      @default(1) @map("max_occupancy")
  totalRooms   Int      @map("total_rooms") // Tổng số phòng loại này
  viewCount    Int      @default(0) @map("view_count") // Số lượt xem
  isActive     Boolean  @default(true) @map("is_active")
  isVerified   Boolean  @default(false) @map("is_verified")

  // Overall Rating fields
  overallRating Decimal? @default(0) @map("overall_rating") @db.Decimal(3, 2)
  totalRatings  Int      @default(0) @map("total_ratings")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  building        Building         @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  roomInstances   RoomInstance[] // Các phòng cụ thể
  amenities       RoomAmenity[]
  costs           RoomCost[]
  images          RoomImage[]
  rules           RoomRule[]
  pricing         RoomPricing?
  roomBookings    RoomBooking[]
  invitations     RoomInvitation[]

  @@index([buildingId])
  @@index([roomType])
  @@index([isActive])
  @@index([slug])
  @@map("rooms")
}

model RoomInstance {
  id         String     @id @default(uuid())
  roomId     String     @map("room_id") // Reference to Room (room type)
  roomNumber String     @map("room_number") // Số phòng cụ thể: "101", "102"
  status     RoomStatus @default(available)
  isActive   Boolean    @default(true) @map("is_active")
  notes      String? // Ghi chú riêng cho phòng này
  createdAt  DateTime   @default(now()) @map("created_at")
  updatedAt  DateTime   @updatedAt @map("updated_at")

  // Relations
  room                 Room                  @relation(fields: [roomId], references: [id], onDelete: Cascade)
  rentals              Rental[]
  monthlyBills         MonthlyBill[]
  contracts            Contract[]
  roommateSeekingPosts RoommateSeekingPost[]

  @@unique([roomId, roomNumber]) // Unique room number within same room type
  @@index([roomId])
  @@index([status])
  @@index([isActive])
  @@map("room_instances")
}

model RoomImage {
  id        String   @id @default(uuid())
  roomId    String   @map("room_id")
  imageUrl  String   @map("image_url")
  altText   String?  @map("alt_text")
  sortOrder Int      @default(0) @map("sort_order")
  isPrimary Boolean  @default(false) @map("is_primary")
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@index([roomId])
  @@map("room_images")
}

// ========================================
// SIMPLIFIED ROOM RULES SYSTEM
// ========================================

model SystemRoomRule {
  id          String       @id @default(uuid())
  name        String
  nameEn      String       @unique @map("name_en")
  category    RuleCategory
  ruleType    RuleType     @default(allowed)
  description String?
  isActive    Boolean      @default(true) @map("is_active")
  sortOrder   Int          @default(0) @map("sort_order")
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")

  // Relations
  roomRules RoomRule[]

  @@index([category])
  @@index([isActive])
  @@map("system_room_rules")
}

model RoomRule {
  id           String   @id @default(uuid())
  roomId       String   @map("room_id")
  systemRuleId String   @map("system_rule_id")
  customValue  String?  @map("custom_value")
  isEnforced   Boolean  @default(true) @map("is_enforced")
  notes        String?
  createdAt    DateTime @default(now()) @map("created_at")

  // Relations
  room       Room           @relation(fields: [roomId], references: [id], onDelete: Cascade)
  systemRule SystemRoomRule @relation(fields: [systemRuleId], references: [id], onDelete: Cascade)

  @@unique([roomId, systemRuleId])
  @@index([roomId])
  @@index([systemRuleId])
  @@map("room_rules")
}

// ========================================
// SIMPLIFIED AMENITIES SYSTEM
// ========================================

model SystemAmenity {
  id          String          @id @default(uuid())
  name        String
  nameEn      String          @unique @map("name_en")
  category    AmenityCategory
  description String?
  isActive    Boolean         @default(true) @map("is_active")
  sortOrder   Int             @default(0) @map("sort_order")
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")

  // Relations
  roomAmenities        RoomAmenity[]
  roomRequestAmenities RoomSeekingPost[]

  @@index([category])
  @@index([isActive])
  @@map("system_amenities")
}

model RoomAmenity {
  id              String   @id @default(uuid())
  roomId          String   @map("room_id")
  systemAmenityId String   @map("system_amenity_id")
  customValue     String?  @map("custom_value")
  notes           String?
  createdAt       DateTime @default(now()) @map("created_at")

  // Relations
  room          Room          @relation(fields: [roomId], references: [id], onDelete: Cascade)
  systemAmenity SystemAmenity @relation(fields: [systemAmenityId], references: [id], onDelete: Cascade)

  @@unique([roomId, systemAmenityId])
  @@index([roomId])
  @@index([systemAmenityId])
  @@map("room_amenities")
}

// ========================================
// SIMPLIFIED COST TYPES SYSTEM
// ========================================

model SystemCostType {
  id          String       @id @default(uuid())
  name        String
  nameEn      String       @unique @map("name_en")
  category    CostCategory
  defaultUnit String?      @map("default_unit")
  description String?
  isActive    Boolean      @default(true) @map("is_active")
  sortOrder   Int          @default(0) @map("sort_order")
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")

  // Relations
  roomCosts RoomCost[]

  @@index([category])
  @@index([isActive])
  @@map("system_cost_types")
}

model RoomCost {
  id               String @id @default(uuid())
  roomId           String @map("room_id")
  systemCostTypeId String @map("system_cost_type_id")

  // Flexible pricing fields
  costType    CostType @default(fixed) @map("cost_type")
  baseRate    Decimal? @map("base_rate") @db.Decimal(15, 2)
  unitPrice   Decimal? @map("unit_price") @db.Decimal(15, 2)
  fixedAmount Decimal? @map("fixed_amount") @db.Decimal(15, 2)

  // Additional pricing info
  currency      String   @default("VND")
  unit          String? // Override default unit from SystemCostType
  minimumCharge Decimal? @map("minimum_charge") @db.Decimal(15, 2)
  maximumCharge Decimal? @map("maximum_charge") @db.Decimal(15, 2)

  // Usage tracking (for metered costs)
  isMetered        Boolean  @default(false) @map("is_metered")
  meterReading     Decimal? @map("meter_reading") @db.Decimal(15, 2)
  lastMeterReading Decimal? @map("last_meter_reading") @db.Decimal(15, 2)

  // Billing configuration
  billingCycle   BillingCycle @default(monthly) @map("billing_cycle")
  includedInRent Boolean      @default(false) @map("included_in_rent")
  isOptional     Boolean      @default(false) @map("is_optional")

  notes     String?
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  room           Room           @relation(fields: [roomId], references: [id], onDelete: Cascade)
  systemCostType SystemCostType @relation(fields: [systemCostTypeId], references: [id], onDelete: Cascade)

  @@unique([roomId, systemCostTypeId])
  @@index([roomId])
  @@index([isActive])
  @@map("room_costs")
}

// ========================================
// PRICING & AVAILABILITY
// ========================================

model RoomPricing {
  id                   String   @id @default(uuid())
  roomId               String   @unique @map("room_id")
  basePriceMonthly     Decimal  @map("base_price_monthly") @db.Decimal(15, 2)
  currency             String   @default("VND")
  depositAmount        Decimal  @map("deposit_amount") @db.Decimal(15, 2)
  depositMonths        Int      @default(1) @map("deposit_months")
  utilityIncluded      Boolean  @default(false) @map("utility_included")
  utilityCostMonthly   Decimal? @map("utility_cost_monthly") @db.Decimal(15, 2)
  cleaningFee          Decimal? @map("cleaning_fee") @db.Decimal(15, 2)
  serviceFeePercentage Decimal? @map("service_fee_percentage") @db.Decimal(5, 2)
  minimumStayMonths    Int      @default(1) @map("minimum_stay_months")
  maximumStayMonths    Int?     @map("maximum_stay_months")
  priceNegotiable      Boolean  @default(false) @map("price_negotiable")
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")

  // Relations
  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@map("room_pricing")
}

// ========================================
// INVITATION & BOOKING MANAGEMENT
// ========================================

model RoomInvitation {
  id                String           @id @default(uuid())
  roomId            String           @map("room_id")
  senderId          String           @map("sender_id") // Landlord
  recipientId       String?          @map("recipient_id") // Tenant (optional if not registered)
  recipientEmail    String?          @map("recipient_email") // For users not yet registered
  roomSeekingPostId String?          @map("room_seeking_post_id")
  monthlyRent       Decimal          @map("monthly_rent") @db.Decimal(15, 2)
  depositAmount     Decimal          @map("deposit_amount") @db.Decimal(15, 2)
  moveInDate        DateTime?        @map("move_in_date") @db.Date
  rentalMonths      Int?             @map("rental_months")
  status            RequestStatus @default(pending)

  // Landlord confirm sau khi tenant accept để tự động tạo rental
  isConfirmedBySender Boolean  @default(false) @map("is_confirmed_by_sender")
  confirmedAt         DateTime? @map("confirmed_at")

  message           String?
  expiresAt         DateTime?        @map("expires_at")
  respondedAt       DateTime?        @map("responded_at")
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")

  // Relations
  room            Room             @relation(fields: [roomId], references: [id], onDelete: Cascade)
  sender          User             @relation("InvitationSender", fields: [senderId], references: [id], onDelete: Cascade)
  recipient       User?            @relation("InvitationReceiver", fields: [recipientId], references: [id], onDelete: Cascade)
  roomSeekingPost RoomSeekingPost? @relation(fields: [roomSeekingPostId], references: [id], onDelete: SetNull)
  rental          Rental?

  @@index([roomId])
  @@index([senderId])
  @@index([recipientId])
  @@index([roomSeekingPostId])
  @@index([status])
  @@index([expiresAt])
  @@map("room_invitations")
}

// ========================================
// BOOKING & RENTAL MANAGEMENT
// ========================================

model RoomBooking {
  id             String            @id @default(uuid())
  roomId         String            @map("room_id")
  tenantId       String            @map("tenant_id")
  moveInDate     DateTime          @map("move_in_date") @db.Date
  moveOutDate    DateTime?         @map("move_out_date") @db.Date
  rentalMonths   Int?             @map("rental_months")
  monthlyRent    Decimal?         @map("monthly_rent") @db.Decimal(15, 2)
  depositAmount  Decimal?         @map("deposit_amount") @db.Decimal(15, 2)
  totalAmount    Decimal?         @map("total_amount") @db.Decimal(15, 2)
  status         RequestStatus @default(pending)
  messageToOwner String?           @map("message_to_owner")
  ownerNotes     String?           @map("owner_notes")

  // Tenant confirm sau khi landlord approve để tự động tạo rental
  isConfirmedByTenant Boolean  @default(false) @map("is_confirmed_by_tenant")
  confirmedAt         DateTime? @map("confirmed_at")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  room   Room    @relation(fields: [roomId], references: [id], onDelete: Cascade)
  tenant User    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  rental Rental?

  @@index([roomId])
  @@index([tenantId])
  @@index([status])
  @@map("room_bookings")
}

model Rental {
  id                    String       @id @default(uuid())
  roomBookingId         String?      @unique @map("room_booking_id")
  invitationId          String?      @unique @map("invitation_id")
  roomInstanceId        String       @map("room_instance_id")
  tenantId              String       @map("tenant_id")
  ownerId               String       @map("owner_id")
  contractStartDate     DateTime     @map("contract_start_date") @db.Date
  contractEndDate       DateTime?    @map("contract_end_date") @db.Date
  monthlyRent           Decimal      @map("monthly_rent") @db.Decimal(15, 2)
  depositPaid           Decimal      @map("deposit_paid") @db.Decimal(15, 2)
  status                RentalStatus @default(active)
  contractDocumentUrl   String?      @map("contract_document_url")
  terminationNoticeDate DateTime?    @map("termination_notice_date") @db.Date
  terminationReason     String?      @map("termination_reason")
  createdAt             DateTime     @default(now()) @map("created_at")
  updatedAt             DateTime     @updatedAt @map("updated_at")

  // Relations
  roomBooking          RoomBooking?          @relation(fields: [roomBookingId], references: [id])
  invitation           RoomInvitation?       @relation(fields: [invitationId], references: [id])
  roomInstance         RoomInstance          @relation(fields: [roomInstanceId], references: [id], onDelete: Cascade)
  tenant               User                  @relation("RentalTenant", fields: [tenantId], references: [id], onDelete: Cascade)
  owner                User                  @relation("RentalOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  payments             Payment[]
  ratings              Rating[]
  monthlyBills         MonthlyBill[]
  contract             Contract?
  roommateSeekingPosts RoommateSeekingPost[]

  @@index([roomInstanceId])
  @@index([tenantId])
  @@index([status])
  @@map("rentals")
}

// ========================================
// MONTHLY BILLING SYSTEM
// ========================================

model MonthlyBill {
  id             String   @id @default(uuid())
  rentalId       String   @map("rental_id")
  roomInstanceId String   @map("room_instance_id")
  billingPeriod  String   @map("billing_period") // "2025-01" format
  billingMonth   Int      @map("billing_month") // 1-12
  billingYear    Int      @map("billing_year")
  periodStart    DateTime @map("period_start") @db.Date
  periodEnd      DateTime @map("period_end") @db.Date

  // Totals
  subtotal        Decimal @db.Decimal(15, 2)
  discountAmount  Decimal @default(0) @map("discount_amount") @db.Decimal(15, 2)
  taxAmount       Decimal @default(0) @map("tax_amount") @db.Decimal(15, 2)
  totalAmount     Decimal @map("total_amount") @db.Decimal(15, 2)
  paidAmount      Decimal @default(0) @map("paid_amount") @db.Decimal(15, 2)
  remainingAmount Decimal @map("remaining_amount") @db.Decimal(15, 2)

  // Status & Dates
  status   BillStatus @default(draft)
  dueDate  DateTime   @map("due_date") @db.Date
  paidDate DateTime?  @map("paid_date")
  notes    String?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  rental       Rental       @relation(fields: [rentalId], references: [id], onDelete: Cascade)
  roomInstance RoomInstance @relation(fields: [roomInstanceId], references: [id], onDelete: Cascade)
  billItems    BillItem[]
  payments     Payment[]

  @@unique([rentalId, billingPeriod])
  @@index([rentalId])
  @@index([roomInstanceId])
  @@index([status])
  @@index([dueDate])
  @@index([billingYear, billingMonth])
  @@map("monthly_bills")
}

model BillItem {
  id            String   @id @default(uuid())
  monthlyBillId String   @map("monthly_bill_id")
  itemType      String   @map("item_type") // "rent", "utility", "service", "other"
  itemName      String   @map("item_name")
  description   String?
  quantity      Decimal? @db.Decimal(10, 2)
  unitPrice     Decimal? @map("unit_price") @db.Decimal(15, 2)
  amount        Decimal  @db.Decimal(15, 2)
  currency      String   @default("VND")
  notes         String?
  createdAt     DateTime @default(now()) @map("created_at")

  // Relations  
  monthlyBill MonthlyBill @relation(fields: [monthlyBillId], references: [id], onDelete: Cascade)

  @@index([monthlyBillId])
  @@index([itemType])
  @@map("bill_items")
}

model Payment {
  id                   String         @id @default(uuid())
  rentalId             String         @map("rental_id")
  monthlyBillId        String?        @map("monthly_bill_id")
  payerId              String         @map("payer_id")
  paymentType          PaymentType    @map("payment_type")
  amount               Decimal        @db.Decimal(15, 2)
  currency             String         @default("VND")
  paymentMethod        PaymentMethod? @map("payment_method")
  paymentStatus        PaymentStatus  @default(pending) @map("payment_status")
  paymentDate          DateTime?      @map("payment_date")
  dueDate              DateTime?      @map("due_date") @db.Date
  description          String?
  transactionReference String?        @map("transaction_reference")
  createdAt            DateTime       @default(now()) @map("created_at")
  updatedAt            DateTime       @updatedAt @map("updated_at")

  // Relations
  rental      Rental       @relation(fields: [rentalId], references: [id], onDelete: Cascade)
  monthlyBill MonthlyBill? @relation(fields: [monthlyBillId], references: [id], onDelete: SetNull)
  payer       User         @relation(fields: [payerId], references: [id], onDelete: Cascade)

  @@index([rentalId])
  @@index([monthlyBillId])
  @@index([payerId])
  @@index([paymentStatus])
  @@index([paymentDate])
  @@map("payments")
}

// ========================================
// REVIEWS
// ========================================


// ========================================
// RATING SYSTEM (ENHANCED)
// ========================================

model Rating {
  id         String           @id @default(uuid())
  targetType RatingTargetType @map("target_type") // tenant, landlord, room
  targetId   String           @map("target_id") // ID của đối tượng được rating
  reviewerId String           @map("reviewer_id") // Người đánh giá
  rentalId   String?          @map("rental_id") // Rental liên quan (optional cho room rating)

  // Simple rating (1-5 scale)
  rating  Int     @map("rating") // Required: 1-5
  content String? // Review text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  reviewer User     @relation("RatingGiver", fields: [reviewerId], references: [id], onDelete: Cascade)
  rental   Rental?  @relation(fields: [rentalId], references: [id], onDelete: SetNull)
  images   String[] // Simple list of image URLs

  @@index([targetType, targetId])
  @@index([reviewerId])
  @@index([rentalId])
  @@index([rating])
  @@index([createdAt])
  @@map("ratings")
}

// ========================================
// ROOM REQUEST (BÀI ĐĂNG TÌM TRỌ)
// ========================================

model RoomSeekingPost {
  id          String @id @default(uuid())
  title       String
  description String
  slug        String @unique @map("slug")

  // Thông tin người đăng
  requesterId String @map("requester_id")

  // Vị trí mong muốn
  preferredDistrictId Int? @map("preferred_district_id")
  preferredWardId     Int? @map("preferred_ward_id")
  preferredProvinceId Int? @map("preferred_province_id")

  // Ngân sách
  minBudget Decimal? @map("min_budget") @db.Decimal(15, 2)
  maxBudget Decimal  @map("max_budget") @db.Decimal(15, 2)
  currency  String   @default("VND")

  // Loại phòng mong muốn
  preferredRoomType RoomType? @map("preferred_room_type")

  // Số người ở
  occupancy Int? // Số người sẽ ở trong phòng

  // Thời gian dự định vào ở
  moveInDate DateTime? @map("move_in_date") @db.Date

  // Trạng thái bài đăng
  status    SearchPostStatus @default(active)
  isPublic  Boolean          @default(true) @map("is_public")
  expiresAt DateTime?        @map("expires_at")

  // Thống kê tương tác
  viewCount    Int @default(0) @map("view_count")
  contactCount Int @default(0) @map("contact_count")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  requester User            @relation(fields: [requesterId], references: [id], onDelete: Cascade)
  amenities SystemAmenity[]

  // Relations
  preferredProvince Province?        @relation(fields: [preferredProvinceId], references: [id], onDelete: SetNull)
  preferredDistrict District?        @relation(fields: [preferredDistrictId], references: [id], onDelete: SetNull)
  preferredWard     Ward?            @relation(fields: [preferredWardId], references: [id], onDelete: SetNull)
  invitations       RoomInvitation[]

  @@index([requesterId])
  @@index([status])
  @@index([preferredProvinceId])
  @@index([preferredDistrictId])
  @@index([preferredWardId])
  @@index([maxBudget])
  @@index([moveInDate])
  @@index([expiresAt])
  @@index([createdAt])
  @@map("room_requests")
}

// ========================================
// ROOMMATE SEEKING SYSTEM
// ========================================

model RoommateSeekingPost {
  id          String @id @default(uuid())
  title       String
  description String
  slug        String @unique

  // Thông tin người đăng (tenant hiện tại)
  tenantId String @map("tenant_id")

  // Platform room info - nếu phòng có trong platform
  roomInstanceId String? @map("room_instance_id")
  rentalId       String? @map("rental_id") // Rental hiện tại của tenant

  // External room info - nếu phòng ngoài platform
  externalAddress    String? @map("external_address")
  externalDistrictId Int?    @map("external_district_id")
  externalProvinceId Int?    @map("external_province_id")
  externalWardId     Int?    @map("external_ward_id")

  // Thông tin cơ bản
  monthlyRent          Decimal  @map("monthly_rent") @db.Decimal(15, 2)
  currency             String   @default("VND")
  depositAmount        Decimal  @map("deposit_amount") @db.Decimal(15, 2)
  utilityCostPerPerson Decimal? @map("utility_cost_per_person") @db.Decimal(15, 2)

  // Số lượng người cần tìm
  seekingCount     Int @map("seeking_count") // Số người cần tìm ban đầu
  approvedCount    Int @default(0) @map("approved_count") // Số người đã được chốt/approve
  remainingSlots   Int @map("remaining_slots") // Số slot còn lại = seekingCount - approvedCount
  maxOccupancy     Int @map("max_occupancy") // Tối đa bao nhiêu người ở ghép
  currentOccupancy Int @default(1) @map("current_occupancy") // Hiện tại có bao nhiêu người (bao gồm tenant)

  // Yêu cầu về roommate (tối giản)
  preferredGender        Gender? @map("preferred_gender")
  additionalRequirements String? @map("additional_requirements") // Text tự do cho các yêu cầu khác

  // Thời gian
  availableFromDate DateTime @map("available_from_date") @db.Date
  minimumStayMonths Int      @default(1) @map("minimum_stay_months")
  maximumStayMonths Int?     @map("maximum_stay_months")

  // Trạng thái & phê duyệt
  status                   RoommatePostStatus @default(draft)
  requiresLandlordApproval Boolean            @default(false) @map("requires_landlord_approval")
  isApprovedByLandlord     Boolean?           @map("is_approved_by_landlord") // null = chưa xét, true/false = đã xét
  landlordNotes            String?            @map("landlord_notes")

  // Visibility
  isActive  Boolean   @default(true) @map("is_active")
  expiresAt DateTime? @map("expires_at")

  // Stats
  viewCount    Int @default(0) @map("view_count")
  contactCount Int @default(0) @map("contact_count")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  tenant       User          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  roomInstance RoomInstance? @relation(fields: [roomInstanceId], references: [id], onDelete: SetNull)
  rental       Rental?       @relation(fields: [rentalId], references: [id], onDelete: SetNull)

  // External location relations
  externalProvince Province? @relation("RoommatePostExternalProvince", fields: [externalProvinceId], references: [id], onDelete: SetNull)
  externalDistrict District? @relation("RoommatePostExternalDistrict", fields: [externalDistrictId], references: [id], onDelete: SetNull)
  externalWard     Ward?     @relation("RoommatePostExternalWard", fields: [externalWardId], references: [id], onDelete: SetNull)

  // Applications
  applications RoommateApplication[]

  @@index([tenantId])
  @@index([roomInstanceId])
  @@index([rentalId])
  @@index([status])
  @@index([externalProvinceId])
  @@index([externalDistrictId])
  @@index([monthlyRent])
  @@index([availableFromDate])
  @@index([expiresAt])
  @@index([remainingSlots])
  @@index([approvedCount])
  @@index([createdAt])
  @@map("roommate_seeking_posts")
}

model RoommateApplication {
  id                    String @id @default(uuid())
  roommateSeekingPostId String @map("roommate_seeking_post_id")
  applicantId           String @map("applicant_id")

  // Thông tin cơ bản của applicant
  fullName    String  @map("full_name")
  occupation  String?
  phoneNumber String  @map("phone_number")

  // Thông tin ở ghép
  moveInDate         DateTime @map("move_in_date") @db.Date
  intendedStayMonths Int?     @map("intended_stay_months")

  // Message & yêu cầu
  applicationMessage String? @map("application_message")

  // Trạng thái
  status RequestStatus @default(pending)

  // Phản hồi từ tenant
  tenantResponse    String?   @map("tenant_response")
  tenantRespondedAt DateTime? @map("tenant_responded_at")

  // Phản hồi từ landlord (chỉ áp dụng cho platform rooms)
  landlordResponse    String?   @map("landlord_response")
  landlordRespondedAt DateTime? @map("landlord_responded_at")

  // Xác nhận 2 chiều để tạo rental
  isConfirmedByTenant   Boolean   @default(false) @map("is_confirmed_by_tenant")
  isConfirmedByLandlord Boolean   @default(false) @map("is_confirmed_by_landlord")
  confirmedAt           DateTime? @map("confirmed_at")

  // Metadata
  isUrgent Boolean @default(false) @map("is_urgent")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  roommateSeekingPost RoommateSeekingPost @relation(fields: [roommateSeekingPostId], references: [id], onDelete: Cascade)
  applicant           User                @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  @@index([roommateSeekingPostId])
  @@index([applicantId])
  @@index([status])
  @@index([moveInDate])
  @@index([createdAt])
  @@map("roommate_applications")
}

// ========================================
// ERROR LOGGING
// ========================================

model ErrorLog {
  id         String   @id @default(uuid())
  message    String
  stack      String?
  level      String   @default("error") // error, warn, fatal
  context    String?
  method     String? // HTTP method
  url        String? // Request URL
  statusCode Int? // HTTP status code
  userId     String?  @map("user_id")
  userAgent  String?  @map("user_agent")
  ipAddress  String?  @map("ip_address")
  requestId  String?  @map("request_id")
  requestUserId String? @map("request_user_id")
  metadata   Json? // Additional error details as JSON
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([level])
  @@index([context])
  @@index([statusCode])
  @@index([userId])
  @@index([requestUserId])
  @@index([createdAt])
  @@map("error_logs")
}

// ========================================
// TENANT PREFERENCES (OPTIMIZED FOR MATCHING)
// ========================================

// Preferences về phòng mong muốn - tương tự RoomSeekingPost
model TenantRoomPreferences {
  id       String @id @default(uuid())
  tenantId String @unique @map("tenant_id")

  // Vị trí ưu tiên (giống RoomSeekingPost)
  preferredProvinceIds Int[] @map("preferred_province_ids")
  preferredDistrictIds Int[] @map("preferred_district_ids")

  // Ngân sách (giống RoomSeekingPost)
  minBudget Decimal? @map("min_budget") @db.Decimal(15, 2)
  maxBudget Decimal  @map("max_budget") @db.Decimal(15, 2)
  currency  String   @default("VND")

  // Loại phòng ưu tiên (giống RoomSeekingPost nhưng multiple)
  preferredRoomTypes RoomType[] @map("preferred_room_types")

  // Số người ở (giống RoomSeekingPost)
  maxOccupancy Int? @map("max_occupancy") // Tối đa bao nhiêu người ở chung

  // Tiện ích quan trọng (subset của SystemAmenity)
  requiresAmenityIds String[] @map("requires_amenity_ids") // Must-have amenities

  // Thời gian thuê
  availableFromDate DateTime? @map("available_from_date") @db.Date
  minLeaseTerm      Int?      @default(3) @map("min_lease_term") // months

  // Metadata
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  tenant User @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([maxBudget])
  @@index([preferredProvinceIds])
  @@index([availableFromDate])
  @@map("tenant_room_preferences")
}

// Preferences về roommate - tối giản nhất cho matching
model TenantRoommatePreferences {
  id       String @id @default(uuid())
  tenantId String @unique @map("tenant_id")

  // Thông tin cơ bản (for matching algorithm)
  preferredGender Gender? @map("preferred_gender")
  preferredAgeMin Int?    @map("preferred_age_min")
  preferredAgeMax Int?    @map("preferred_age_max")

  // Lifestyle preferences (boolean for easy matching)
  allowsSmoking Boolean @default(false) @map("allows_smoking")
  allowsPets    Boolean @default(false) @map("allows_pets")
  allowsGuests  Boolean @default(true) @map("allows_guests")

  // Cleanliness & social level (1-5 scale for scoring)
  cleanlinessLevel       Int? @map("cleanliness_level") // 1-5
  socialInteractionLevel Int? @map("social_interaction_level") // 1-5 (1=minimal, 5=high)

  // Deal breakers (most important for filtering)
  dealBreakers String[] @map("deal_breakers") // ["smoking", "pets", "loud_music"]

  // Metadata
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  tenant User @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([preferredGender])
  @@index([allowsSmoking])
  @@index([allowsPets])
  @@map("tenant_roommate_preferences")
}

// ========================================
// CHAT (1-1 CONVERSATIONS)
// ========================================

model Conversation {
  id            String    @id @default(uuid())
  userAId       String    @map("user_a_id")
  userBId       String    @map("user_b_id")
  lastMessageAt DateTime? @map("last_message_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  // Relations
  userA    User      @relation("ConversationUserA", fields: [userAId], references: [id], onDelete: Cascade)
  userB    User      @relation("ConversationUserB", fields: [userBId], references: [id], onDelete: Cascade)
  messages Message[]

  @@unique([userAId, userBId])
  @@index([lastMessageAt])
  @@map("conversations")
}

model Message {
  id             String          @id @default(uuid())
  conversationId String          @map("conversation_id")
  senderId       String          @map("sender_id")
  type           ChatMessageType @default(text)
  content        String?
  isEdited       Boolean         @default(false) @map("is_edited")
  sentAt         DateTime        @default(now()) @map("sent_at")
  readAt         DateTime?       @map("read_at")

  // Relations
  conversation Conversation        @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender       User                @relation(fields: [senderId], references: [id], onDelete: Cascade)
  attachments  MessageAttachment[]

  @@index([conversationId, sentAt])
  @@index([senderId])
  @@map("messages")
}

model MessageAttachment {
  id        String   @id @default(uuid())
  messageId String   @map("message_id")
  url       String
  mimeType  String   @map("mime_type")
  byteSize  Int?     @map("byte_size")
  width     Int?
  height    Int?
  isImage   Boolean  @default(false) @map("is_image")
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
  @@map("message_attachments")
}

// ========================================
// ELECTRONIC CONTRACT SYSTEM
// ========================================

model Contract {
  id           String  @id @default(uuid())
  contractCode String  @unique @map("contract_code") // HD-2025-000001
  rentalId     String? @unique @map("rental_id")

  // Các bên tham gia
  landlordId     String @map("landlord_id")
  tenantId       String @map("tenant_id")
  roomInstanceId String @map("room_instance_id")

  // Loại và trạng thái
  contractType ContractType   @default(monthly_rental)
  status       ContractStatus @default(draft)

  // Nội dung hợp đồng (JSON)
  contractData Json @map("contract_data")

  // Thời hạn hợp đồng
  startDate DateTime  @map("start_date") @db.Date
  endDate   DateTime? @map("end_date") @db.Date

  // File PDF và bảo mật
  pdfUrl  String? @map("pdf_url")
  pdfHash String? @map("pdf_hash") // SHA-256
  pdfSize Int?    @map("pdf_size") // bytes

  // Thời điểm quan trọng
  signedAt     DateTime? @map("signed_at")
  activatedAt  DateTime? @map("activated_at")
  terminatedAt DateTime? @map("terminated_at")

  // Metadata pháp lý
  legalMetadata Json @map("legal_metadata")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  rental       Rental?             @relation(fields: [rentalId], references: [id])
  landlord     User                @relation("LandlordContracts", fields: [landlordId], references: [id])
  tenant       User                @relation("TenantContracts", fields: [tenantId], references: [id])
  roomInstance RoomInstance        @relation(fields: [roomInstanceId], references: [id])
  signatures   ContractSignature[]
  auditLogs    ContractAuditLog[]

  @@index([status, createdAt])
  @@index([landlordId])
  @@index([tenantId])
  @@index([signedAt])
  @@map("contracts")
}

model ContractSignature {
  id         String     @id @default(uuid())
  contractId String     @map("contract_id")
  signerId   String     @map("signer_id")
  signerRole SignerRole @map("signer_role")

  // Chữ ký canvas
  signatureImage String @map("signature_image") // Base64 PNG
  signatureHash  String @map("signature_hash") // SHA-256 của image

  // Xác thực theo Nghị định 91/2023/NĐ-CP
  authenticationMethod String @map("authentication_method") // "SMS_OTP"
  authenticationData   Json   @map("authentication_data")

  // Metadata theo Luật Giao dịch điện tử 2023
  signatureMetadata Json @map("signature_metadata")

  // Trạng thái
  isValid  Boolean  @default(true) @map("is_valid")
  signedAt DateTime @map("signed_at")

  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  contract Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)
  signer   User     @relation(fields: [signerId], references: [id])

  @@unique([contractId, signerId])
  @@index([contractId])
  @@map("contract_signatures")
}

model ContractAuditLog {
  id         String  @id @default(uuid())
  contractId String  @map("contract_id")
  userId     String? @map("user_id")

  action        String // created, viewed, signed, modified, terminated
  actionDetails Json   @map("action_details")

  // Thông tin kỹ thuật (bắt buộc theo luật)
  ipAddress String  @map("ip_address")
  userAgent String  @map("user_agent")
  sessionId String? @map("session_id")

  timestamp DateTime @default(now())

  // Relations
  contract Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)
  user     User?    @relation(fields: [userId], references: [id])

  @@index([contractId, timestamp])
  @@index([action])
  @@map("contract_audit_logs")
}

// ========================================
// SYSTEM TABLES
// ========================================

model Notification {
  id               String    @id @default(uuid())
  userId           String    @map("user_id")
  notificationType String    @map("notification_type")
  title            String
  message          String
  data             Json?
  isRead           Boolean   @default(false) @map("is_read")
  readAt           DateTime? @map("read_at")
  expiresAt        DateTime? @map("expires_at")
  createdAt        DateTime  @default(now()) @map("created_at")

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

// ========================================
// LOCATION TABLES
// ========================================
model Province {
  id        Int      @id @default(autoincrement())
  code      String   @unique @map("province_code")
  name      String   @map("province_name")
  nameEn    String?  @map("province_name_en")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  districts                    District[]
  userAddresses                UserAddress[]
  buildings                    Building[]
  roomRequests                 RoomSeekingPost[]
  roommateSeekingPostsExternal RoommateSeekingPost[] @relation("RoommatePostExternalProvince")

  @@index([code])
  @@map("provinces")
}

model District {
  id         Int      @id @default(autoincrement())
  code       String   @unique @map("district_code")
  name       String   @map("district_name")
  nameEn     String?  @map("district_name_en")
  provinceId Int      @map("province_id")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  province                     Province              @relation(fields: [provinceId], references: [id], onDelete: Cascade)
  wards                        Ward[]
  userAddresses                UserAddress[]
  buildings                    Building[]
  roomRequests                 RoomSeekingPost[]
  roommateSeekingPostsExternal RoommateSeekingPost[] @relation("RoommatePostExternalDistrict")

  @@index([code])
  @@index([provinceId])
  @@map("districts")
}

model Ward {
  id         Int      @id @default(autoincrement())
  code       String   @unique @map("ward_code")
  name       String   @map("ward_name")
  nameEn     String?  @map("ward_name_en")
  level      String   @map("ward_level") // "Phường", "Xã", "Thị trấn"
  districtId Int      @map("district_id")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  district                     District              @relation(fields: [districtId], references: [id], onDelete: Cascade)
  userAddresses                UserAddress[]
  buildings                    Building[]
  roomRequests                 RoomSeekingPost[]
  roommateSeekingPostsExternal RoommateSeekingPost[] @relation("RoommatePostExternalWard")

  @@index([code])
  @@index([districtId])
  @@map("wards")
}
