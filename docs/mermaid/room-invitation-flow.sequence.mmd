sequenceDiagram
    participant L as Landlord
    participant RI as RoomInvitationsService
    participant T as Tenant
    participant R as RentalsService
    participant C as ContractsService
    participant N as NotificationsService
    
    L->>RI: POST /room-invitations
    Note over RI: Validate landlord role
    Note over RI: Check room ownership
    Note over RI: Check existing invitations
    Note over RI: Check existing bookings
    RI->>RI: Create invitation
    RI->>N: Notify tenant of invitation
    RI-->>L: Invitation sent
    
    T->>RI: PATCH /room-invitations/:id/respond (accept)
    Note over RI: Validate tenant authorization
    RI->>RI: Update status to 'accepted'
    RI->>RI: Update room instance to occupied
    RI->>N: Notify landlord of acceptance
    
    Note over RI,C: AUTO-GENERATION STARTS
    RI->>R: createRental(senderId, rentalData)
    Note over R: Create rental with invitation data
    R->>N: Notify rental created
    R->>C: autoCreateContractFromRental(rentalId)
    Note over C: Generate contract number
    Note over C: Build contract from rental data
    Note over C: Create Vietnamese contract text
    C->>N: Notify contract created
    C-->>R: Contract created successfully
    R-->>RI: Rental created successfully
    RI-->>T: Invitation accepted with rental & contract
    
    Note over L,T: Active rental with contract ready

