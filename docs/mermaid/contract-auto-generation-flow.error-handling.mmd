flowchart TD
    A[Contract Generation Triggered] --> B{Rental Data Valid?}
    
    B -->|No| C[Throw BadRequest]
    B -->|Yes| D[Generate Contract Number]
    
    D --> E{Number Generation OK?}
    E -->|No| F[Log Error & Retry]
    E -->|Yes| G[Build Contract Content]
    
    F --> G
    
    G --> H{Content Build OK?}
    H -->|No| I[Log Error & Use Template]
    H -->|Yes| J[Create Contract DTO]
    
    I --> J
    
    J --> K{DTO Creation OK?}
    K -->|No| L[Log Critical Error]
    K -->|Yes| M[Send Notifications]
    
    L --> N[Return Partial Success]
    
    M --> O{Notification OK?}
    O -->|No| P[Log Warning]
    O -->|Yes| Q[Complete Success]
    
    P --> Q
    
    style Q fill:#90EE90
    style N fill:#FFB347
    style C fill:#FF6B6B

